!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("martinez",[],r):"object"==typeof exports?exports.martinez=r():t.martinez=r()}("undefined"!=typeof self?self:this,function(){return function(t){var r={};function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=6)}([function(t,r,e){"use strict";var n=e(5);t.exports=function(t,r){var e=t.point,o=r.point;return e[0]>o[0]?1:e[0]<o[0]?-1:e[1]!==o[1]?e[1]>o[1]?1:-1:function(t,r,e,o){if(t.left!==r.left)return t.left?1:-1;if(0!==n(e,t.otherEvent.point,r.otherEvent.point))return t.isBelow(r.otherEvent.point)?-1:1;return!t.isSubject&&r.isSubject?1:-1}(t,r,e)}},function(t,r,e){"use strict";t.exports={INTERSECTION:0,UNION:1,DIFFERENCE:2,XOR:3}},function(t,r,e){"use strict";t.exports={NORMAL:0,NON_CONTRIBUTING:1,SAME_TRANSITION:2,DIFFERENT_TRANSITION:3}},function(t,r,e){"use strict";t.exports=function(t,r){return t[0]===r[0]&&t[1]===r[1]}},function(t,r,e){"use strict";var n=e(2);function o(t,r,e,o,i){this.left=r,this.point=t,this.otherEvent=e,this.isSubject=o,this.type=i||n.NORMAL,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}o.prototype={isBelow:function(t){var r=this.point,e=this.otherEvent.point;return this.left?(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])>0:(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])>0},isAbove:function(t){return!this.isBelow(t)},isVertical:function(){return this.point[0]===this.otherEvent.point[0]},clone:function(){var t=new o(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}},t.exports=o},function(t,r,e){"use strict";t.exports=function(t,r,e){return(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])}},function(t,r,e){"use strict";var n=e(7),o=e(15),i=e(16),u=e(1),a=[];function s(t,r,e){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof r[0][0][0]&&(r=[r]);var s=function(t,r,e){var n=null;return t.length*r.length==0&&(e===u.INTERSECTION?n=a:e===u.DIFFERENCE?n=t:e!==u.UNION&&e!==u.XOR||(n=0===t.length?r:t)),n}(t,r,e);if(s)return s===a?null:s;var h=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],f=i(t,r,h,l);if(s=function(t,r,e,n,o){var i=null;return(e[0]>n[2]||n[0]>e[2]||e[1]>n[3]||n[1]>e[3])&&(o===u.INTERSECTION?i=a:o===u.DIFFERENCE?i=t:o!==u.UNION&&o!==u.XOR||(i=t.concat(r))),i}(t,r,h,l,e))return s===a?null:s;var c=n(f,t,r,h,l,e);return o(c,e)}s.union=function(t,r){return s(t,r,u.UNION)},s.diff=function(t,r){return s(t,r,u.DIFFERENCE)},s.xor=function(t,r){return s(t,r,u.XOR)},s.intersection=function(t,r){return s(t,r,u.INTERSECTION)},s.operations=u,t.exports=s,t.exports.default=s},function(t,r,e){"use strict";var n=e(8).default,o=e(10),i=e(11),u=e(14),a=e(1);t.exports=function(t,r,e,s,h,l){for(var f,c,p,v=new n(u),E=[],g=Math.min(s[2],h[2]),I=a.INTERSECTION,b=a.DIFFERENCE;t.length;){var d=t.pop();if(E.push(d),l===I&&d.point[0]>g||l===b&&d.point[0]>s[2])break;if(d.left){c=f=v.insert(d),f=f!==(p=v.minNode())?v.prev(f):null,c=v.next(c);var O,_=f?f.key:null;if(o(d,_,l),c&&2===i(d,c.key,t)&&(o(d,_,l),o(d,c.key,l)),f&&2===i(f.key,d,t)){var N=f;O=(N=N!==p?v.prev(N):null)?N.key:null,o(_,O,l),o(d,_,l)}}else d=d.otherEvent,c=f=v.find(d),f&&c&&(f=f!==p?v.prev(f):null,c=v.next(c),v.remove(d),c&&f&&i(f.key,c.key,t))}return E}},function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e(9);function o(t,r){return t>r?1:t<r?-1:0}function i(t){var r=t.right;return t.right=r.left,r.left&&(r.left.parent=t),r.parent=t.parent,r.parent&&(r.parent.left===t?r.parent.left=r:r.parent.right=r),t.parent=r,r.left=t,t.balanceFactor+=1,r.balanceFactor<0&&(t.balanceFactor-=r.balanceFactor),r.balanceFactor+=1,t.balanceFactor>0&&(r.balanceFactor+=t.balanceFactor),r}function u(t){var r=t.left;return t.left=r.right,t.left&&(t.left.parent=t),r.parent=t.parent,r.parent&&(r.parent.left===t?r.parent.left=r:r.parent.right=r),t.parent=r,r.right=t,t.balanceFactor-=1,r.balanceFactor>0&&(t.balanceFactor-=r.balanceFactor),r.balanceFactor-=1,t.balanceFactor<0&&(r.balanceFactor+=t.balanceFactor),r}r.default=class{constructor(t,r=!1){this._comparator=t||o,this._root=null,this._size=0,this._noDuplicates=!!r}destroy(){return this._root=null,this}get size(){return this._size}contains(t){if(this._root)for(var r=this._root,e=this._comparator;r;){var n=e(t,r.key);if(0===n)return!0;r=n<0?r.left:r.right}return!1}next(t){var r=t;if(r)if(r.right)for(r=r.right;r&&r.left;)r=r.left;else for(r=t.parent;r&&r.right===t;)t=r,r=r.parent;return r}prev(t){var r=t;if(r)if(r.left)for(r=r.left;r&&r.right;)r=r.right;else for(r=t.parent;r&&r.left===t;)t=r,r=r.parent;return r}forEach(t){for(var r=this._root,e=[],n=!1,o=0;!n;)r?(e.push(r),r=r.left):e.length>0?(t(r=e.pop(),o++),r=r.right):n=!0;return this}keys(){for(var t=this._root,r=[],e=[],n=!1;!n;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),e.push(t.key),t=t.right):n=!0;return e}values(){for(var t=this._root,r=[],e=[],n=!1;!n;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),e.push(t.data),t=t.right):n=!0;return e}at(t){for(var r=this._root,e=[],n=!1,o=0;!n;)if(r)e.push(r),r=r.left;else if(e.length>0){if(r=e.pop(),o===t)return r;o++,r=r.right}else n=!0;return null}minNode(){var t=this._root;if(!t)return null;for(;t.left;)t=t.left;return t}maxNode(){var t=this._root;if(!t)return null;for(;t.right;)t=t.right;return t}min(){var t=this._root;if(!t)return null;for(;t.left;)t=t.left;return t.key}max(){var t=this._root;if(!t)return null;for(;t.right;)t=t.right;return t.key}isEmpty(){return!this._root}pop(){var t=this._root,r=null;if(t){for(;t.left;)t=t.left;r={key:t.key,data:t.data},this.remove(t.key)}return r}find(t){for(var r,e=this._root,n=e,o=this._comparator;n;){if(0===(r=o(t,n.key)))return n;n=r<0?n.left:n.right}return null}insert(t,r){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:t,data:r},this._size++,this._root;var e=this._comparator,n=this._root,o=null,a=0;if(this._noDuplicates)for(;n;){if(o=n,0===(a=e(t,n.key)))return null;n=a<0?n.left:n.right}else for(;n;)o=n,n=(a=e(t,n.key))<=0?n.left:n.right;var s,h={left:null,right:null,balanceFactor:0,parent:o,key:t,data:r};for(a<=0?o.left=h:o.right=h;o&&((a=e(o.key,t))<0?o.balanceFactor-=1:o.balanceFactor+=1,0!==o.balanceFactor);){if(o.balanceFactor<-1){1===o.right.balanceFactor&&u(o.right),s=i(o),o===this._root&&(this._root=s);break}if(o.balanceFactor>1){-1===o.left.balanceFactor&&i(o.left),s=u(o),o===this._root&&(this._root=s);break}o=o.parent}return this._size++,h}remove(t){if(!this._root)return null;for(var r=this._root,e=this._comparator,n=0;r&&0!==(n=e(t,r.key));)r=n<0?r.left:r.right;if(!r)return null;var o,a,s=r.key;if(r.left){for(o=r.left;o.left||o.right;){for(;o.right;)o=o.right;r.key=o.key,r.data=o.data,o.left&&(r=o,o=o.left)}r.key=o.key,r.data=o.data,r=o}if(r.right){for(a=r.right;a.left||a.right;){for(;a.left;)a=a.left;r.key=a.key,r.data=a.data,a.right&&(r=a,a=a.right)}r.key=a.key,r.data=a.data,r=a}for(var h,l=r.parent,f=r;l&&(l.left===f?l.balanceFactor-=1:l.balanceFactor+=1,l.balanceFactor<-1?(1===l.right.balanceFactor&&u(l.right),h=i(l),l===this._root&&(this._root=h),l=h):l.balanceFactor>1&&(-1===l.left.balanceFactor&&i(l.left),h=u(l),l===this._root&&(this._root=h),l=h),-1!==l.balanceFactor&&1!==l.balanceFactor);)f=l,l=l.parent;return r.parent&&(r.parent.left===r?r.parent.left=null:r.parent.right=null),r===this._root&&(this._root=null),this._size--,s}load(t=[],r=[]){if(Array.isArray(t))for(var e=0,n=t.length;e<n;e++)this.insert(t[e],r[e]);return this}isBalanced(){return Object(n.a)(this._root)}toString(t){return Object(n.b)(this._root,t)}}},function(t,r,e){"use strict";r.b=function(t,r=(t=>t.key)){var e=[];return function t(r,e,n,o,i){if(r){o(`${e}${n?"└── ":"├── "}${i(r)}\n`);const u=e+(n?"    ":"│   ");r.left&&t(r.left,u,!1,o,i),r.right&&t(r.right,u,!0,o,i)}}(t,"",!0,t=>e.push(t),r),e.join("")},r.a=function t(r){if(null===r)return!0;var e=n(r.left);var o=n(r.right);if(Math.abs(e-o)<=1&&t(r.left)&&t(r.right))return!0;return!1};function n(t){return t?1+Math.max(n(t.left),n(t.right)):0}},function(t,r,e){"use strict";var n=e(2),o=e(1),i=o.INTERSECTION,u=o.UNION,a=o.DIFFERENCE,s=o.XOR;t.exports=function(t,r,e){null===r?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===r.isSubject?(t.inOut=!r.inOut,t.otherInOut=r.otherInOut):(t.inOut=!r.otherInOut,t.otherInOut=r.isVertical()?!r.inOut:r.inOut),r&&(t.prevInResult=!h(r,e)||r.isVertical()?r.prevInResult:r)),t.inResult=h(t,e)};function h(t,r){switch(t.type){case n.NORMAL:switch(r){case i:return!t.otherInOut;case u:return t.otherInOut;case a:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case s:return!0}break;case n.SAME_TRANSITION:return r===i||r===u;case n.DIFFERENT_TRANSITION:return r===a;case n.NON_CONTRIBUTING:return!1}return!1}},function(t,r,e){"use strict";var n=e(12),o=e(13),i=e(3),u=e(0),a=e(2);t.exports=function(t,r,e){var s=o(t.point,t.otherEvent.point,r.point,r.otherEvent.point),h=s?s.length:0;if(0===h)return 0;if(1===h&&(i(t.point,r.point)||i(t.otherEvent.point,r.otherEvent.point)))return 0;if(2===h&&t.isSubject===r.isSubject)return 0;if(1===h)return i(t.point,s[0])||i(t.otherEvent.point,s[0])||n(t,s[0],e),i(r.point,s[0])||i(r.otherEvent.point,s[0])||n(r,s[0],e),1;var l=[],f=!1,c=!1;return i(t.point,r.point)?f=!0:1===u(t,r)?l.push(r,t):l.push(t,r),i(t.otherEvent.point,r.otherEvent.point)?c=!0:1===u(t.otherEvent,r.otherEvent)?l.push(r.otherEvent,t.otherEvent):l.push(t.otherEvent,r.otherEvent),f&&c||f?(r.type=a.NON_CONTRIBUTING,t.type=r.inOut===t.inOut?a.SAME_TRANSITION:a.DIFFERENT_TRANSITION,f&&!c&&n(l[1].otherEvent,l[0].point,e),2):c?(n(l[0],l[1].point,e),3):l[0]!==l[3].otherEvent?(n(l[0],l[1].point,e),n(l[1],l[2].point,e),3):(n(l[0],l[1].point,e),n(l[3].otherEvent,l[2].point,e),3)}},function(t,r,e){"use strict";var n=e(4),o=e(3),i=e(0);t.exports=function(t,r,e){var u=new n(r,!1,t,t.isSubject),a=new n(r,!0,t.otherEvent,t.isSubject);return o(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),u.contourId=a.contourId=t.contourId,i(a,t.otherEvent)>0&&(t.otherEvent.left=!0,a.left=!1),t.otherEvent.otherEvent=a,t.otherEvent=u,e.push(a),e.push(u),e}},function(t,r,e){"use strict";function n(t,r){return t[0]*r[1]-t[1]*r[0]}function o(t,r){return t[0]*r[0]+t[1]*r[1]}t.exports=function(t,r,e,i,u){var a=[r[0]-t[0],r[1]-t[1]],s=[i[0]-e[0],i[1]-e[1]];function h(t,r,e){return[t[0]+r*e[0],t[1]+r*e[1]]}var l=[e[0]-t[0],e[1]-t[1]],f=n(a,s),c=f*f,p=o(a,a);if(c>1e-9*p*o(s,s)){var v=n(l,s)/f;if(v<0||v>1)return null;var E=n(l,a)/f;return E<0||E>1?null:u?null:[h(t,v,a)]}var g=o(l,l);if((c=(f=n(l,a))*f)>1e-9*p*g)return null;var I=o(a,l)/p,b=I+o(a,s)/p,d=Math.min(I,b),O=Math.max(I,b);return d<=1&&O>=0?1===d?u?null:[h(t,d>0?d:0,a)]:0===O?u?null:[h(t,O<1?O:1,a)]:u&&0===d&&1===O?null:[h(t,d>0?d:0,a),h(t,O<1?O:1,a)]:null}},function(t,r,e){"use strict";var n=e(5),o=e(0),i=e(3);t.exports=function(t,r){if(t===r)return 0;if(0!==n(t.point,t.otherEvent.point,r.point)||0!==n(t.point,t.otherEvent.point,r.otherEvent.point))return i(t.point,r.point)?t.isBelow(r.otherEvent.point)?-1:1:t.point[0]===r.point[0]?t.point[1]<r.point[1]?-1:1:1===o(t,r)?r.isAbove(t.point)?-1:1:t.isBelow(r.point)?-1:1;if(t.isSubject!==r.isSubject)return t.isSubject?-1:1;var e=t.point,u=r.point;return e[0]===u[0]&&e[1]===u[1]?(e=t.otherEvent.point,u=r.otherEvent.point,e[0]===u[0]&&e[1]===u[1]?0:t.contourId>r.contourId?1:-1):1===o(t,r)?1:-1}},function(t,r,e){"use strict";var n=e(0),o=e(1);function i(t,r,e,n){var o=t+1,i=r.length;if(o>i-1)return t-1;for(var u=r[t].point,a=r[o].point;o<i&&a[0]===u[0]&&a[1]===u[1];){if(!e[o])return o;a=r[++o].point}for(o=t-1;e[o]&&o>=n;)o--;return o}t.exports=function(t,r){var e,u,a,s=function(t){var r,e,o,i,u=[];for(e=0,o=t.length;e<o;e++)((r=t[e]).left&&r.inResult||!r.left&&r.otherEvent.inResult)&&u.push(r);for(var a=!1;!a;)for(a=!0,e=0,o=u.length;e<o;e++)e+1<o&&1===n(u[e],u[e+1])&&(i=u[e],u[e]=u[e+1],u[e+1]=i,a=!1);for(e=0,o=u.length;e<o;e++)(r=u[e]).pos=e,r.left||(i=r.pos,r.pos=r.otherEvent.pos,r.otherEvent.pos=i);return u}(t),h={},l=[];for(e=0,u=s.length;e<u;e++)if(!h[e]){var f=[[]];s[e].isExteriorRing?r===o.DIFFERENCE&&!s[e].isSubject&&l.length>1?l[l.length-1].push(f[0]):l.push(f):0===l.length?l.push([[f]]):l[l.length-1].push(f[0]);var c=l.length-1,p=e,v=s[e].point;for(f[0].push(v);p>=e;)a=s[p],h[p]=!0,a.left?(a.resultInOut=!1,a.contourId=c):(a.otherEvent.resultInOut=!0,a.otherEvent.contourId=c),h[p=a.pos]=!0,f[0].push(s[p].point),p=i(p,s,h,e);a=s[p=-1===p?e:p],h[p]=h[a.pos]=!0,a.otherEvent.resultInOut=!0,a.otherEvent.contourId=c}return l}},function(t,r,e){"use strict";var n=e(17),o=e(4),i=e(0),u=Math.max,a=Math.min,s=0;function h(t,r,e,n,s,h){var l,f,c,p,v,E;for(l=0,f=t.length-1;l<f;l++)if(c=t[l],p=t[l+1],v=new o(c,!1,void 0,r),E=new o(p,!1,v,r),v.otherEvent=E,c[0]!==p[0]||c[1]!==p[1]){v.contourId=E.contourId=e,h||(v.isExteriorRing=!1,E.isExteriorRing=!1),i(v,E)>0?E.left=!0:v.left=!0;var g=c[0],I=c[1];s[0]=a(s[0],g),s[1]=a(s[1],I),s[2]=u(s[2],g),s[3]=u(s[3],I),n.push(v),n.push(E)}}t.exports=function(t,r,e,o){var u,a,l,f,c,p,v=new n(null,i);for(l=0,f=t.length;l<f;l++)for(c=0,p=(u=t[l]).length;c<p;c++)(a=0===c)&&s++,h(u[c],!0,s,v,e,a);for(l=0,f=r.length;l<f;l++)for(c=0,p=(u=r[l]).length;c<p;c++)(a=0===c)&&s++,h(u[c],!1,s,v,o,a);return v}},function(t,r,e){"use strict";t.exports=n,t.exports.default=n;function n(t,r){if(!(this instanceof n))return new n(t,r);if(this.data=t||[],this.length=this.data.length,this.compare=r||o,this.length>0)for(var e=(this.length>>1)-1;e>=0;e--)this._down(e)}function o(t,r){return t<r?-1:t>r?1:0}n.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var r=this.data,e=this.compare,n=r[t];t>0;){var o=t-1>>1,i=r[o];if(e(n,i)>=0)break;r[t]=i,t=o}r[t]=n},_down:function(t){for(var r=this.data,e=this.compare,n=this.length>>1,o=r[t];t<n;){var i=1+(t<<1),u=i+1,a=r[i];if(u<this.length&&e(r[u],a)<0&&(i=u,a=r[u]),e(a,o)>=0)break;r[t]=a,t=i}r[t]=o}}}])});