!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("martinez",[],e):"object"==typeof exports?exports.martinez=e():t.martinez=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e,n){"use strict";var r=n(5);t.exports=function(t,e){var n=t.point,o=e.point;return n[0]>o[0]?1:n[0]<o[0]?-1:n[1]!==o[1]?n[1]>o[1]?1:-1:function(t,e,n,o){if(t.left!==e.left)return t.left?1:-1;if(0!==r(n,t.otherEvent.point,e.otherEvent.point))return t.isBelow(e.otherEvent.point)?-1:1;return!t.isSubject&&e.isSubject?1:-1}(t,e,n)}},function(t,e,n){"use strict";t.exports={INTERSECTION:0,UNION:1,DIFFERENCE:2,XOR:3}},function(t,e,n){"use strict";t.exports={NORMAL:0,NON_CONTRIBUTING:1,SAME_TRANSITION:2,DIFFERENT_TRANSITION:3}},function(t,e,n){"use strict";t.exports=function(t,e){return t[0]===e[0]&&t[1]===e[1]}},function(t,e,n){"use strict";var r=n(2);function o(t,e,n,o,i){this.left=e,this.point=t,this.otherEvent=n,this.isSubject=o,this.type=i||r.NORMAL,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}o.prototype={isBelow:function(t){var e=this.point,n=this.otherEvent.point;return this.left?(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])>0:(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1])>0},isAbove:function(t){return!this.isBelow(t)},isVertical:function(){return this.point[0]===this.otherEvent.point[0]},clone:function(){var t=new o(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}},t.exports=o},function(t,e,n){"use strict";t.exports=function(t,e,n){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}},function(t,e,n){"use strict";var r=n(7),o=n(15),i=n(16),u=n(1),a=[];function l(t,e,n){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var l=function(t,e,n){var r=null;return t.length*e.length==0&&(n===u.INTERSECTION?r=a:n===u.DIFFERENCE?r=t:n!==u.UNION&&n!==u.XOR||(r=0===t.length?e:t)),r}(t,e,n);if(l)return l===a?null:l;var s=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],h=i(t,e,s,f);if(l=function(t,e,n,r,o){var i=null;return(n[0]>r[2]||r[0]>n[2]||n[1]>r[3]||r[1]>n[3])&&(o===u.INTERSECTION?i=a:o===u.DIFFERENCE?i=t:o!==u.UNION&&o!==u.XOR||(i=t.concat(e))),i}(t,e,s,f,n))return l===a?null:l;var c=r(h,t,e,s,f,n);return o(c,n)}l.union=function(t,e){return l(t,e,u.UNION)},l.diff=function(t,e){return l(t,e,u.DIFFERENCE)},l.xor=function(t,e){return l(t,e,u.XOR)},l.intersection=function(t,e){return l(t,e,u.INTERSECTION)},l.operations=u,t.exports=l,t.exports.default=l},function(t,e,n){"use strict";var r=n(8).default,o=n(10),i=n(11),u=n(14),a=n(1);t.exports=function(t,e,n,l,s,f){for(var h,c,p,v=new r(u),g=[],E=Math.min(l[2],s[2]),y=a.INTERSECTION,I=a.DIFFERENCE;t.length;){var d=t.pop();if(g.push(d),f===y&&d.point[0]>E||f===I&&d.point[0]>l[2])break;if(d.left){c=h=v.insert(d),h=h!==(p=v.minNode())?v.prev(h):null,c=v.next(c);var b,_=h?h.key:null;if(o(d,_,f),c&&2===i(d,c.key,t)&&(o(d,_,f),o(d,c.key,f)),h&&2===i(h.key,d,t)){var O=h;b=(O=O!==p?v.prev(O):null)?O.key:null,o(_,b,f),o(d,_,f)}}else d=d.otherEvent,c=h=v.find(d),h&&c&&(h=h!==p?v.prev(h):null,c=v.next(c),v.remove(d),c&&h&&i(h.key,c.key,t))}return g}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(9);function i(t,e){return t>e?1:t<e?-1:0}function u(t){var e=t.right;return t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.left=t,t.balanceFactor+=1,e.balanceFactor<0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor+=1,t.balanceFactor>0&&(e.balanceFactor+=t.balanceFactor),e}function a(t){var e=t.left;return t.left=e.right,t.left&&(t.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.right=t,t.balanceFactor-=1,e.balanceFactor>0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor-=1,t.balanceFactor<0&&(e.balanceFactor+=t.balanceFactor),e}var l=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._comparator=e||i,this._root=null,this._size=0,this._noDuplicates=!!n}return r(t,[{key:"destroy",value:function(){return this._root=null,this}},{key:"contains",value:function(t){if(this._root)for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}},{key:"next",value:function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e}},{key:"prev",value:function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e}},{key:"forEach",value:function(t){for(var e=this._root,n=[],r=!1,o=0;!r;)e?(n.push(e),e=e.left):n.length>0?(t(e=n.pop(),o++),e=e.right):r=!0;return this}},{key:"keys",value:function(){for(var t=this._root,e=[],n=[],r=!1;!r;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),n.push(t.key),t=t.right):r=!0;return n}},{key:"values",value:function(){for(var t=this._root,e=[],n=[],r=!1;!r;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),n.push(t.data),t=t.right):r=!0;return n}},{key:"at",value:function(t){for(var e=this._root,n=[],r=!1,o=0;!r;)if(e)n.push(e),e=e.left;else if(n.length>0){if(e=n.pop(),o===t)return e;o++,e=e.right}else r=!0;return null}},{key:"minNode",value:function(){var t=this._root;if(!t)return null;for(;t.left;)t=t.left;return t}},{key:"maxNode",value:function(){var t=this._root;if(!t)return null;for(;t.right;)t=t.right;return t}},{key:"min",value:function(){var t=this._root;if(!t)return null;for(;t.left;)t=t.left;return t.key}},{key:"max",value:function(){var t=this._root;if(!t)return null;for(;t.right;)t=t.right;return t.key}},{key:"isEmpty",value:function(){return!this._root}},{key:"pop",value:function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e}},{key:"find",value:function(t){for(var e,n=this._root,r=this._comparator;n;){if(0===(e=r(t,n.key)))return n;n=e<0?n.left:n.right}return null}},{key:"insert",value:function(t,e){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:t,data:e},this._size++,this._root;var n=this._comparator,r=this._root,o=null,i=0;if(this._noDuplicates)for(;r;){if(o=r,0===(i=n(t,r.key)))return null;r=i<0?r.left:r.right}else for(;r;)o=r,r=(i=n(t,r.key))<=0?r.left:r.right;var l,s={left:null,right:null,balanceFactor:0,parent:o,key:t,data:e};for(i<=0?o.left=s:o.right=s;o&&((i=n(o.key,t))<0?o.balanceFactor-=1:o.balanceFactor+=1,0!==o.balanceFactor);){if(o.balanceFactor<-1){1===o.right.balanceFactor&&a(o.right),l=u(o),o===this._root&&(this._root=l);break}if(o.balanceFactor>1){-1===o.left.balanceFactor&&u(o.left),l=a(o),o===this._root&&(this._root=l);break}o=o.parent}return this._size++,s}},{key:"remove",value:function(t){if(!this._root)return null;for(var e=this._root,n=this._comparator,r=0;e&&0!==(r=n(t,e.key));)e=r<0?e.left:e.right;if(!e)return null;var o,i,l=e.key;if(e.left){for(o=e.left;o.left||o.right;){for(;o.right;)o=o.right;e.key=o.key,e.data=o.data,o.left&&(e=o,o=o.left)}e.key=o.key,e.data=o.data,e=o}if(e.right){for(i=e.right;i.left||i.right;){for(;i.left;)i=i.left;e.key=i.key,e.data=i.data,i.right&&(e=i,i=i.right)}e.key=i.key,e.data=i.data,e=i}for(var s,f=e.parent,h=e;f&&(f.left===h?f.balanceFactor-=1:f.balanceFactor+=1,f.balanceFactor<-1?(1===f.right.balanceFactor&&a(f.right),s=u(f),f===this._root&&(this._root=s),f=s):f.balanceFactor>1&&(-1===f.left.balanceFactor&&u(f.left),s=a(f),f===this._root&&(this._root=s),f=s),-1!==f.balanceFactor&&1!==f.balanceFactor);)h=f,f=f.parent;return e.parent&&(e.parent.left===e?e.parent.left=null:e.parent.right=null),e===this._root&&(this._root=null),this._size--,l}},{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(Array.isArray(t))for(var n=0,r=t.length;n<r;n++)this.insert(t[n],e[n]);return this}},{key:"isBalanced",value:function(){return(0,o.isBalanced)(this._root)}},{key:"toString",value:function(t){return(0,o.print)(this._root,t)}},{key:"size",get:function(){return this._size}}]),t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.print=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t.key},n=[];return function t(e,n,r,o,i){if(e){o(n+(r?"└── ":"├── ")+i(e)+"\n");var u=n+(r?"    ":"│   ");e.left&&t(e.left,u,!1,o,i),e.right&&t(e.right,u,!0,o,i)}}(t,"",!0,function(t){return n.push(t)},e),n.join("")},e.isBalanced=function t(e){if(null===e)return!0;var n=r(e.left);var o=r(e.right);if(Math.abs(n-o)<=1&&t(e.left)&&t(e.right))return!0;return!1};function r(t){return t?1+Math.max(r(t.left),r(t.right)):0}},function(t,e,n){"use strict";var r=n(2),o=n(1),i=o.INTERSECTION,u=o.UNION,a=o.DIFFERENCE,l=o.XOR;t.exports=function(t,e,n){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!s(e,n)||e.isVertical()?e.prevInResult:e)),t.inResult=s(t,n)};function s(t,e){switch(t.type){case r.NORMAL:switch(e){case i:return!t.otherInOut;case u:return t.otherInOut;case a:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case l:return!0}break;case r.SAME_TRANSITION:return e===i||e===u;case r.DIFFERENT_TRANSITION:return e===a;case r.NON_CONTRIBUTING:return!1}return!1}},function(t,e,n){"use strict";var r=n(12),o=n(13),i=n(3),u=n(0),a=n(2);t.exports=function(t,e,n){var l=o(t.point,t.otherEvent.point,e.point,e.otherEvent.point),s=l?l.length:0;if(0===s)return 0;if(1===s&&(i(t.point,e.point)||i(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===s&&t.isSubject===e.isSubject)return 0;if(1===s)return i(t.point,l[0])||i(t.otherEvent.point,l[0])||r(t,l[0],n),i(e.point,l[0])||i(e.otherEvent.point,l[0])||r(e,l[0],n),1;var f=[],h=!1,c=!1;return i(t.point,e.point)?h=!0:1===u(t,e)?f.push(e,t):f.push(t,e),i(t.otherEvent.point,e.otherEvent.point)?c=!0:1===u(t.otherEvent,e.otherEvent)?f.push(e.otherEvent,t.otherEvent):f.push(t.otherEvent,e.otherEvent),h&&c||h?(e.type=a.NON_CONTRIBUTING,t.type=e.inOut===t.inOut?a.SAME_TRANSITION:a.DIFFERENT_TRANSITION,h&&!c&&r(f[1].otherEvent,f[0].point,n),2):c?(r(f[0],f[1].point,n),3):f[0]!==f[3].otherEvent?(r(f[0],f[1].point,n),r(f[1],f[2].point,n),3):(r(f[0],f[1].point,n),r(f[3].otherEvent,f[2].point,n),3)}},function(t,e,n){"use strict";var r=n(4),o=n(3),i=n(0);t.exports=function(t,e,n){var u=new r(e,!1,t,t.isSubject),a=new r(e,!0,t.otherEvent,t.isSubject);return o(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),u.contourId=a.contourId=t.contourId,i(a,t.otherEvent)>0&&(t.otherEvent.left=!0,a.left=!1),t.otherEvent.otherEvent=a,t.otherEvent=u,n.push(a),n.push(u),n}},function(t,e,n){"use strict";function r(t,e){return t[0]*e[1]-t[1]*e[0]}function o(t,e){return t[0]*e[0]+t[1]*e[1]}t.exports=function(t,e,n,i,u){var a=[e[0]-t[0],e[1]-t[1]],l=[i[0]-n[0],i[1]-n[1]];function s(t,e,n){return[t[0]+e*n[0],t[1]+e*n[1]]}var f=[n[0]-t[0],n[1]-t[1]],h=r(a,l),c=h*h,p=o(a,a);if(c>1e-9*p*o(l,l)){var v=r(f,l)/h;if(v<0||v>1)return null;var g=r(f,a)/h;return g<0||g>1?null:u?null:[s(t,v,a)]}var E=o(f,f);if((c=(h=r(f,a))*h)>1e-9*p*E)return null;var y=o(a,f)/p,I=y+o(a,l)/p,d=Math.min(y,I),b=Math.max(y,I);return d<=1&&b>=0?1===d?u?null:[s(t,d>0?d:0,a)]:0===b?u?null:[s(t,b<1?b:1,a)]:u&&0===d&&1===b?null:[s(t,d>0?d:0,a),s(t,b<1?b:1,a)]:null}},function(t,e,n){"use strict";var r=n(5),o=n(0),i=n(3);t.exports=function(t,e){if(t===e)return 0;if(0!==r(t.point,t.otherEvent.point,e.point)||0!==r(t.point,t.otherEvent.point,e.otherEvent.point))return i(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===o(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var n=t.point,u=e.point;return n[0]===u[0]&&n[1]===u[1]?(n=t.otherEvent.point,u=e.otherEvent.point,n[0]===u[0]&&n[1]===u[1]?0:t.contourId>e.contourId?1:-1):1===o(t,e)?1:-1}},function(t,e,n){"use strict";var r=n(0),o=n(1);function i(t,e,n,r){var o=t+1,i=e.length;if(o>i-1)return t-1;for(var u=e[t].point,a=e[o].point;o<i&&a[0]===u[0]&&a[1]===u[1];){if(!n[o])return o;a=e[++o].point}for(o=t-1;n[o]&&o>=r;)o--;return o}t.exports=function(t,e){var n,u,a,l=function(t){var e,n,o,i,u=[];for(n=0,o=t.length;n<o;n++)((e=t[n]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&u.push(e);for(var a=!1;!a;)for(a=!0,n=0,o=u.length;n<o;n++)n+1<o&&1===r(u[n],u[n+1])&&(i=u[n],u[n]=u[n+1],u[n+1]=i,a=!1);for(n=0,o=u.length;n<o;n++)(e=u[n]).pos=n,e.left||(i=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=i);return u}(t),s={},f=[];for(n=0,u=l.length;n<u;n++)if(!s[n]){var h=[[]];l[n].isExteriorRing?e===o.DIFFERENCE&&!l[n].isSubject&&f.length>1?f[f.length-1].push(h[0]):f.push(h):0===f.length?f.push([[h]]):f[f.length-1].push(h[0]);var c=f.length-1,p=n,v=l[n].point;for(h[0].push(v);p>=n;)a=l[p],s[p]=!0,a.left?(a.resultInOut=!1,a.contourId=c):(a.otherEvent.resultInOut=!0,a.otherEvent.contourId=c),s[p=a.pos]=!0,h[0].push(l[p].point),p=i(p,l,s,n);a=l[p=-1===p?n:p],s[p]=s[a.pos]=!0,a.otherEvent.resultInOut=!0,a.otherEvent.contourId=c}return f}},function(t,e,n){"use strict";var r=n(17),o=n(4),i=n(0),u=Math.max,a=Math.min,l=0;function s(t,e,n,r,l,s){var f,h,c,p,v,g;for(f=0,h=t.length-1;f<h;f++)if(c=t[f],p=t[f+1],v=new o(c,!1,void 0,e),g=new o(p,!1,v,e),v.otherEvent=g,c[0]!==p[0]||c[1]!==p[1]){v.contourId=g.contourId=n,s||(v.isExteriorRing=!1,g.isExteriorRing=!1),i(v,g)>0?g.left=!0:v.left=!0;var E=c[0],y=c[1];l[0]=a(l[0],E),l[1]=a(l[1],y),l[2]=u(l[2],E),l[3]=u(l[3],y),r.push(v),r.push(g)}}t.exports=function(t,e,n,o){var u,a,f,h,c,p,v=new r(null,i);for(f=0,h=t.length;f<h;f++)for(c=0,p=(u=t[f]).length;c<p;c++)(a=0===c)&&l++,s(u[c],!0,l,v,n,a);for(f=0,h=e.length;f<h;f++)for(c=0,p=(u=e[f]).length;c<p;c++)(a=0===c)&&l++,s(u[c],!1,l,v,o,a);return v}},function(t,e,n){"use strict";t.exports=r,t.exports.default=r;function r(t,e){if(!(this instanceof r))return new r(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||o,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function o(t,e){return t<e?-1:t>e?1:0}r.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var o=t-1>>1,i=e[o];if(n(r,i)>=0)break;e[t]=i,t=o}e[t]=r},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,o=e[t];t<r;){var i=1+(t<<1),u=i+1,a=e[i];if(u<this.length&&n(e[u],a)<0&&(i=u,a=e[u]),n(a,o)>=0)break;e[t]=a,t=i}e[t]=o}}}])});